好的，這份 `PROTOCOL.md` 是我們專案的「法律文件」，修改它需要非常嚴謹。

根據我們達成的 `output_file` 共識，以及對未來 `target_files` 的規劃，我為您準備了一份**完整、精確**的修改方案。

請用以下內容，**完整替換**您現有的 `PROTOCOL.md` 文件：

```markdown
# Laplace Sentry Control - 通信協議 (v2.0)

**版本說明:** 
- v1.x: 舊版協議，使用 md_file 和 target_files 命名。
- v2.0: **命名升級**。引入 `output_file` 作為單文件模式下的權威欄位，並明確 `target_files` 為未來多文件模式的預留欄位。

---

## 模板：新指令格式 (Template)

> **說明：** 所有新指令的文檔，都必須嚴格遵循此模板結構。

```
### X. `指令名稱 <參數1> <參數2>`
    
- **指令:** `指令名稱`
- **方向:** 客戶端 -> 服務器
- **描述:** [用一句話清晰地描述這個指令的意圖和作用。]
- **參數 (可選):**
  - `<參數1>`: [參數的描述 (類型)]。
  - `<參數2>`: [參數的描述 (類型)]。
- **成功響應 (stdout):**
  - [描述成功時，服務器必須返回的確切內容。]
- **失敗響應 (stderr):**
  - `ERROR: [第一種可能的錯誤信息]` ([中文註解])
  - `ERROR: [第二種可能的錯誤信息]` ([中文註解])
```

---

## 數據模型與全局原則 (v2.0 命名升級版)

- **數據模型:** 
  - **當前 (單文件模式):** 權威欄位是 `"output_file": "/path/to/your/file.ext"` (字串)。
  - **未來 (多文件模式):** 權威欄位將是 `"target_files": ["/path/to/file1.ext", "/path/to/file2.ext"]` (陣列)。
  - **兼容策略:** 當前所有寫入操作，必須同時維護 `output_file` (字串) 和 `target_files` (單元素陣列)，以確保平滑過渡。
- **失敗策略:** 所有專家與工作流必須遵循「快速失敗 (Fail-Fast)」原則。任何可預期的錯誤都必須立即中止操作並返回非零退出碼。

---

## 基礎指令

### 1. `ping`

- **指令:** `ping`
- **方向:** 客戶端 -> 服務器
- **描述:** 用於檢測與服務器的連接是否暢通。
- **成功響應 (stdout):** 服務器必須返回一個由單詞 `PONG` 和一個換行符組成的字串。

### 2. `list_projects`

- **指令:** `list_projects`
- **方向:** 客戶端 -> 服務器
- **描述:** 請求服務器返回當前所有已註冊專案的完整列表。
- **成功響應 (stdout):** 服務器必須返回 `data/projects.json` 文件的原始 JSON 內容。如果文件不存在或為空，應返回一個空的 JSON 陣列 `[]`。

---

## 名單管理指令

### 3. `add_project <name> <path> <output_file>`

- **指令:** `add_project`
- **方向:** 客戶端 -> 服務器
- **描述:** 指示服務器新增一個專案。所有參數都必須提供。
- **參數:**
  - `<name>`: 專案的唯一別名 (字串)。
  - `<path>`: 要監控的專案目錄的絕對路徑 (字串)。
  - **`<output_file>`**: 要更新的單個輸出文件的絕對路徑 (字串)。
- **成功響應 (stdout):**
  - 服務器必須返回單詞 `OK` 和一個換行符。
- **失敗響應 (stderr):**
  - `【新增失敗】：...` (及其他後端驗證錯誤)

### 4. `edit_project <uuid> <field> <new_value>`

- **指令:** `edit_project`
- **方向:** 客戶端 -> 服務器
- **描述:** 指示服務器修改指定專案的某個欄位值。
- **參數:**
  - `<uuid>`: 要修改的專案的唯一標識符 (字串)。
  - `<field>`: 要修改的欄位名稱，必須是 `name`, `path`, 或 **`output_file`** 之一 (字串)。
  - `<new_value>`: 要設置的新值 (字串)。
- **成功響應 (stdout):**
  - 服務器必須返回單詞 `OK` 和一個換行符。
- **失敗響應 (stderr):**
  - `【編輯失敗】：未找到具有該 UUID 的專案。`
  - `【編輯失敗】：無效的欄位名稱。只能修改 'name', 'path', 或 'output_file'。`
  - (及其他後端驗證錯誤)

### 5. `delete_project <uuid>`

- **指令:** `delete_project`
- **方向:** 客戶端 -> 服務器
- **描述:** 指示服務器刪除一個指定的專案。
- **參數:**
  - `<uuid>`: 要刪除的專案的唯一標識符 (字串)。
- **成功響應 (stdout):**
  - 服務器必須返回單詞 `OK` 和一個換行符。
- **失敗響應 (stderr):**
  - `【刪除失敗】：未找到具有該 UUID 的專案。`

---

## 手動觸發指令

### 6. `manual_update <uuid>`

- **指令:** `manual_update`
- **方向:** 客戶端 -> 服務器
- **描述:** 指示服務器對指定專案，執行一次完整的手動更新工作流。
- **參數:**
  - `<uuid>`: 要更新的專案的唯一標識符 (字串)。
- **成功響應 (stdout):**
  - 服務器在執行過程中，會將日誌實時打印到標準輸出。最終以退出碼 `0` 結束。
- **失敗響應 (stderr):**
  - `【手動更新失敗】：...` (及其他後端執行錯誤)

### 7. `manual_direct <project_path> <output_file>`

- **指令:** `manual_direct`
- **方向:** 客戶端 -> 服務器
- **描述:** 指示服務器繞開專案名單，直接對指定的路徑執行一次更新。
- **參數:**
  - `<project_path>`: 要掃描的專案目錄的絕對路徑 (字串)。
  - `<output_file>`: 要寫入的輸出文件的絕對路徑 (字串)。
- **成功響應 (stdout):**
  - 服務器在執行過程中，會將日誌實時打印到標準輸出。最終以退出碼 `0` 結束。
- **失敗響應 (stderr):**
  - `【手動更新失敗】：...` (及其他後端執行錯誤)
```

