# 版本發布記錄 (Release Log)

## v8.1.0-Guardian (2025-11-13)

**版本類型:** 功能與健壯性更新 (Feature & Robustness Update)

**版本描述:**
本版本實現了完整的哨兵生命週期管理，並顯著增強了系統的狀態監控與容錯能力。通過對後端服務 `daemon.py` 的重構，引入了基於「進程存活性」與「路徑有效性」的雙重健康檢查機制，確保了狀態報告的準確性與持久性。前端 `main.py` 的交互流程也已同步升級，以支持對哨兵的菜單化管理和多維度狀態的可視化。

### ✨ 核心變更 (Core Changes):

- **【功能】哨兵生命週期管理:**
  - **[新增]** 在 `daemon.py` 中實現了 `handle_start_sentry` 和 `handle_stop_sentry` 函式，使用 `subprocess.Popen` 對 `sentry_worker.py` 子進程進行背景化管理。
  - **[新增]** 實現了將子進程的 `stdout` 和 `stderr` 重定向到 `logs/` 目錄下對應專案日誌文件的功能。
  - **[新增]** 在 `main.py` 中，將哨兵管理操作（啟動/停止）集成到 `_select_project` 表格化選擇菜單中。

- **【健壯性】狀態監控與自愈機制:**
  - **[重構]** 重構了 `daemon.py` 的 `handle_list_projects` 函式，對**所有**已註冊專案執行「路徑有效性」檢查，並對運行中的哨兵執行「PID 存活性」檢查。
  - **[新增]** 引入了「殭屍自愈」邏輯：當健康檢查失敗時，系統會自動終止失效的子進程，並將其從 `running_sentries` 狀態字典中移除。
  - **[修正]** 解決了 `invalid_path` 狀態無法持久化顯示的問題，確保了前端狀態與後端真實情況的一致性。
  - **[新增]** 在 `handle_start_sentry` 中增加了對專案路徑的前置有效性驗證，防止啟動無效的哨兵進程。

### 🛠️ 技術性結論 (Technical Conclusions):

- **狀態管理:** 確立了由 `handle_list_projects` 作為系統狀態的唯一權威報告來源，所有狀態檢查與自愈邏輯均收斂於此。
- **前後端契約:** `daemon.py` 現在通過 `status` 欄位 (`running`, `stopped`, `invalid_path`)，向 `main.py` 提供了一套清晰、明確的狀態契約。

---

## v8.0.0-Bedrock (2025-11-10)

**版本類型:** 災難恢復與健壯性基線 (Disaster Recovery & Robustness Baseline)

**版本描述:**
本版本是在經歷了 `v7.0.0-alpha` 後續開發中的災難性失敗（日誌 053），並做出「戰略硬重置」的重大決策後，建立的一個全新的、穩如磐石的「基岩」版本。它不僅繼承了早期版本中最核心的「I/O 網關」架構，更重要的是，它完整地、精準地重建了我們在歷史上已驗證過的、最寶貴的健壯性資產——「I/O 自愈系統」。`v8.0.0-Bedrock` 標誌著專案在經歷了重大挫折後，成功地回歸到一個更健康、更可靠、且具備了強大容錯能力的全新起點，為後續所有功能的重建，提供了無可動搖的信心基石。

### ✨ 核心成就 (Core Achievements):

- **✅ 災難恢復資產完全回歸:**
  - **[I/O 自愈系統]** 完整重建了在 `projects.json` 損壞時，能「自動從備份恢復」並「通過前端無感重試」的完整自愈流程。
  - **[集中化管理]** 完整重建了將所有 `.lock` 和帶時間戳的 `.bak` 文件，統一存放在 `temp/` 目錄下的集中管理機制，確保了核心數據區的絕對乾淨。

- **✅ 前後端架構優化:**
  - **[原地重試]** 在 `main.py` 中實現了基於「退出碼 10」的「原地自動重試」機制，極大地提升了在後端自動恢復場景下的用戶體驗。
  - **[信號傳遞]** 確立了 `io_gateway` -> `daemon.py` -> `main.py` 之間，通過「自定義異常」和「特殊退出碼」進行狀態信號傳遞的、清晰的通信模式。

- **✅ 工程實踐標準化:**
  - **[目錄結構]** 首次將 `temp/` 和 `logs/` 目錄通過 `.gitkeep` 文件納入版本控制，確保了專案在任何新環境下都具備一致的、可運行的目錄結構。
  - **[文檔對齊]** 在提交前，對 `.gitignore`, `PROTOCOL.md` 等核心治理文件進行了全面對齊，確保了版本庫的準確性與一致性。

### 🛠️ 戰略性結論 (Strategic Conclusions):

- **誠實面對失敗:** 本次版本的誕生，本身就是對「承認失敗、果斷回退、從穩定基線重建」這一核心工程原則的最高肯定。
- **資產藍圖的價值:** 《災難恢復手冊》在此次重建過程中，發揮了決定性的「藍圖」作用，證明了「用自然語言記錄已實現功能」的寶貴價值。

---


# 版本發布記錄 (Release Log)

v6.0.0-alpha (2025-11-07)
版本類型: 架構重構與穩定性里程碑 (Architectural Refactoring & Stability Milestone)
版本描述:
本版本是專案歷史上一次意義重大的「心臟移植手術」。為徹底根除因 subprocess 調用和多進程 I/O 競爭而引發的、一系列頑固的「幽靈 Bug」，我們廢棄了原有的、分散的 I/O 邏輯，並引入了一個全新的、集中的「I/O 網關 (io_gateway.py)」。這個新架構不僅一勞永逸地解決了文件鎖失效的問題，更將專案的穩定性、可測試性和架構的優雅性，提升到了一個全新的高度。
✨ 核心成就 (Core Achievements):
✅ 全新架構：I/O 網關 (io_gateway.py)
[引入] 創建了全新的 io_gateway.py，作為系統唯一的、安全的 I/O 事務處理中心。
[實現] 在網關中，通過 portalocker 和「回調函式」模式，成功實現了對所有文件操作的原子性和線程安全保護。
[驗證] 新的 I/O 網關，已通過嚴格的、多進程並發寫入的單元測試 (test_file_lock.py)，證明其絕對可靠。
✅ 核心模塊解耦 (daemon.py)
[重構] daemon.py 的所有文件讀寫操作，現已全部委託給 io_gateway.py 處理。
[簡化] daemon.py 的職責回歸純粹的「業務邏輯指揮」，其內部程式碼（如 handle_add_project）變得極其簡潔、清晰、且易於理解。
✅ 技術債清償:
[完成] 徹底清償了《技術債清單》中，關於「單檔鎖」和「原子寫入」的所有歷史欠債。
[統一] 確立了「所有 I/O 都必須通過網關」的開發新原則，為未來的代碼質量提供了堅實的制度保障。
🛠️ 架構性結論 (Architectural Conclusions):
設計哲學確立: 再次用實踐證明，將「變化的業務邏輯」與「不變的基礎設施（如 I/O、日誌）」進行徹底分離，是構建複雜、健壯系統的唯一康莊大道。
協作模式升級: 本次重構，是「由 AI 提出架構草案，由人類專家進行審批、質疑、並主導最終方案」這一高級協作模式的成功典範。


## v5.1-docs (2025-11-03)

**版本類型:** 文檔與可讀性重構 (Documentation & Readability Refactoring)

**版本描述:**
本版本是一次專注於「提升程式碼內在價值」的重大維護版本。在 `v5.0-basecamp` 的堅實基礎之上，我們發起了一場全面的「註釋風格統一戰役」，旨在將《極簡融合式程式碼註解風格指南》應用到每一個核心腳本中。其最終目標，是將程式碼從「僅僅能運行」，升級為「能自我教學」的、活的專案文檔。

### ✨ 核心成就 (Core Achievements):

- **✅ 註釋風格全面統一:**
  - **[覆蓋範圍]** 成功對 `main.py`, `daemon.py`, `engine.py`, `path.py`, `formatter.py` 和 `worker.sh` 等所有核心腳本，進行了徹底的註釋重構。
  - **[遵循指南]** 所有註釋均嚴格遵循「極簡融合」原則，將中文語義與英文關鍵字無縫結合，極大地降低了非技術背景協作者的閱讀門檻。

- **✅ 程式碼「歷史考古」價值注入:**
  - **[歷史沉澱]** 通過 `HACK:`, `DEFENSE:`, `COMPAT:`, `FUTURE:`, `TODO:` 等標籤，成功地將專案的歷史決策、架構妥協、防禦性設計、以及未來的技術債，全部「編碼」進了註釋之中。
  - **[自文檔化]** 程式碼現在不僅解釋了「它在做什麼 (What)」，更重要的是解釋了「它為什麼這麼做 (Why)」，成為了一份名副其實的「自文檔化」教學材料。

### 🛠️ 架構性結論 (Architectural Conclusions):

- **協作模式升級:** 本次重構確立了「由人類專家主導修改，由 AI 助手擔任代碼審查員」的全新協作模式。該模式在確保程式碼質量的同時，最大限度地保證了人類協作者的掌控感與創造力。
- **資產價值提升:** 專案的核心資產，已從單純的「功能性程式碼」，升級為包含「設計思想」與「歷史傳承」的、更具長期價值的「知識資產」。

---


## v5.0-Basecamp (2025-11-03)

**版本類型:** 里程碑版本 (Milestone Release)

**版本描述:**
本版本標誌著專案「C/S 架構奠基」階段的全面勝利收官。在經歷了從 `control.sh` 到 `main.py` 的史詩級架構躍遷，以及對「命名體系」和「數據模型」的戰略性升級後，我們最終清償了所有已知的、關於路徑處理和數據一致性的核心技術債。`v5.0-Basecamp` 是我們後端核心能力，首次通過完整生命週期契約測試的、穩如磐石的「大本營」版本，為後續所有核心功能的開發，掃清了全部障礙。

### ✨ 核心功能與成就 (Core Features & Achievements):

- **✅ 架構躍遷 (`main.py`):**
  - **[廢棄]** 徹底廢棄了在 WSL 環境下存在底層穩定性風險的 `control.sh` 客戶端。
  - **[確立]** 成功將專案唯一的交互入口，遷移至更穩定、更健壯的 Python 腳本 `main.py`，並確立了「由根目錄總入口調用 `src/` 模塊」的現代化 Python 專案架構。

- **✅ 命名與數據模型升級:**
  - **[統一]** 廢棄了有歧義的 `md_file` 命名，全面轉向更具擴展性的 `output_file` 命名體系。
  - **[加固]** 確立並實現了兼容未來的「雙陣列」數據模型，從根本上杜絕了數據庫寫入時的格式不一致問題。
  - **[兼容]** 在 `daemon.py` 中建立了 `_get_targets_from_project` 兼容層，確保系統能溫柔地處理所有歷史數據格式。

- **✅ 後端核心能力 (`daemon.py`):**
  - **[通過驗收]** 完整的「增、刪、改、查」名單管理後端，已通過覆蓋完整生命週期的自動化契約測試，證明其絕對健壯。
  - **[恢復資產]** 成功在新架構下，恢復了「手動更新」這一核心調試資產。

### 🛠️ 架構性結論與已知風險 (Architectural Conclusions & Known Risks):

- **核心結論 (日誌 033):** 跨語言的 `subprocess` 調用，在處理複雜的跨系統文件權限時，存在不可預測的、根本性的穩定性風險。
- **核心決策:** 基於上述結論，確立了「**廢除 `worker.sh`，將其所有調度邏輯，完全統一到單一的 Python 語言環境中**」的長期戰略目標。
- **已知風險:** 當前的「手動更新」功能，仍然依賴於調用外部的 `worker.sh`。這意味著它繼承了所有 `subprocess` 跨語言調用的潛在風險，在未來的哨兵自動化場景中，可能再次成為不穩定因素。

---


# 版本發布記錄 (Release Log)

## v4.0-Phoenix (2025-10-28)

**版本類型:** 穩定性與正確性修正 (Stability & Correctness Fix)

**版本描述:**
本版本是【階段零：安全與穩定衝刺】的最終產物，其核心目標是根除在 v1.0 之後引入的、導致「中文註釋丟失」的歷史遺留核心 Bug。通過一次決定性的架構回歸，本版本不僅徹底解決了該問題，更確立了未來文本處理的、更可靠的設計哲學，使整個系統達到了前所未有的健壯性。

### ✨ 核心功能與修正 (Core Features & Fixes):

- **✅ 核心算法修正 (註釋丟失 Bug 根治):**
  - **[廢棄]** 徹底廢棄了自 v1.0 起，基於「相對路徑計算」的、複雜且不穩定的註釋匹配算法。
  - **[回歸]** 移植並優化了 v0 版本基於「**視覺模式匹配**」的註釋算法。新算法通過純粹的文本行匹配，從根本上杜絕了因輸入格式（如 ` ``` `）污染而導致的計算偏差，實現了 100% 的註釋保留。

- **✅ 核心流程健壯性增強:**
  - **數據通道 (`stdin`):** 確立了使用標準輸入管道 (`|`) 作為腳本間數據傳遞的唯一通道，解決了因文件名包含特殊字符而導致的參數解析錯誤。
  - **哨兵管理 (`pidfile`):** 確立了使用 `--pidfile` 機制對 `inotifywait` 進程進行精準追蹤與管理，徹底解決了「殭屍進程」問題。
  - **✅ (補記) 併發安全 (`flock`):** 在 `worker.sh` 中成功實裝了 `flock` 文件鎖機制。這確保了即使在高頻文件變更的極端情況下，也只有一個 `worker.sh` 實例能夠執行寫入操作，從根本上防止了因併發執行而導致的數據錯亂和資源競爭問題。

- **✅ 兼容性確認:**
  - **Markdown (`README.md`):** 明確了當前的「Obsidian 格式」本質上就是一種高度兼容的 Markdown 代碼塊實現，確認了系統對通用 `README.md` 文件的完美支持。

### 🛠️ 架構性結論 (Architectural Conclusions):

- **設計哲學確立:** 用實踐證明，在處理具有不確定包裹格式的文本時，**簡單、直接的「視覺模式匹配」，遠比複雜、精巧的「邏輯計算」更健壯、更可靠。**
- **專家職責固化:** `engine.py` 的職責被進一步確認為「生產純文本內容」，而 `formatter.py` 的職責是「為內容進行格式化包裝」，二者之間的界限更加清晰。

### ⚠️ 已知限制 (Known Limitations):

- **交付方式單一:** 當前的交付流程僅支持「寫入本地文件」，尚未實現對 Notion 等遠程 API 平台的交付能力。

---

# 版本發布記錄 (Release Log)

## v1.0-mvp (2025-10-27)

**版本類型:** 最小可行產品 (Minimum Viable Product)

**版本描述:**
本版本是「通用目錄哨兵控制中心」的首個功能完整、流程閉環的穩定版本。它確立了專案的核心架構，並實現了所有基礎功能，為後續的迭代開發奠定了堅實的基礎。

### ✨ 核心功能 (Core Features):

- **✅ 專家架構:**
  - **管理專家 (`control.sh`):** 基於菜單的中央控制器，負責所有用戶交互與任務分發。
  - **結構專家 (`engine.py`):** 純粹的、無副作用的目錄樹生成與註解合併引擎。
  - **路徑專家 (`path.py`):** 健壯的、支持跨平台路徑轉換的 I/O 工具箱。
  - **工人腳本 (`worker.sh`):** 獨立的、負責執行後台文件監控與更新任務的執行單元。

- **✅ 核心工作流:**
  - **名單管理:** 完整支持對 `projects.json` 中的專案進行「增、刪、改、查」的全生命週期管理。
  - **哨兵系統:**
    - 支持對**單個**專案，啟動一個獨立的、背景化的 `inotifywait` 監控進程。
    - 支持通過 PID 檔案，對指定的專案哨兵，進行精準的停止操作。
    - 哨兵在監測到文件系統變化後，能自動觸發 `worker.sh` 執行更新。
  - **自動創建:** `worker.sh` 能在目標 Markdown 文件**不存在**的情況下，自動創建並寫入目錄樹，實現了「零配置」啟動。

- **✅ 診斷與測試:**
  - **診斷專家 (`diagnostics.sh`):** 包含針對各專家和核心流程的單元/集成測試，為專案的健壯性提供了基礎保障。

### ⚠️ 已知限制 (Known Limitations):

- **多哨兵健壯性:** 當前的後台邏輯，其在管理多個並發哨兵時的健壯性**未經嚴格的集成測試**驗證。
- **交互流程:** 菜單交互流程較為僵化，缺乏上下文保留和靈活的返回機制。
- **容錯機制:** 缺乏對「專案目錄失聯」、「孤兒註解」等異常情況的處理。
